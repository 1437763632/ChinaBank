
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Update</title>
    <script src="~/Scripts/jquery-3.1.1.js"></script>
    <link href="~/BootstrapSouce/css/bootstrap.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
</head>
<body>
        <div id="add">
            <table class="table table-hover">
                <tr>
                    <td>角色名称: </td>
                    <td><input type="text" name="RoleName" /></td>
                </tr>
                <tr>
                    <td>权限角色:</td>
                    <td id="dl1">
                    </td>
                </tr>
                <tr>
                    <td><a href="javascript:;" onclick="">添加</a></td>
                    <td><a href="#" onclick="location.href='/Role/Index'">显示</a></td>
                </tr>
            </table>
        </div>
</body>
</html>
<script type="text/javascript">
    $(function () {
        Show();
        //反填
            $.ajax({
                url: 'http://localhost:8086/rbac/showRolesID?id='+@Request.QueryString["id"] ,
                type:'get',
               // async:false,
                success: function (data) {
                    $("input[name=RoleName]").val(data[0].RoleName)
                    $(data).each(function (index,data) {
                        $("input[name=PermissionName][value=" + data.PermissionId + "]").prop("checked", true)
                    })
                }
        })
        //修改
        $("#add").click(function () {

            var ids = [];
            $("input[name=PermissionName]:checked").each(function () {
                ids.push($(this).val())
            })
            alert(ids)
            console.log($("[name=RoleName]").val())
            $.ajax({
                url: 'http://localhost:8086/rbac/RoleUpdate?RoleName=' + $("[name=RoleName]").val() + '&RightID=' + ids +'&Id='+@Request.QueryString["id"],
                type: 'post',
                success: function (data) {
                    
                    if (data > 0) {
                        alert("修改成功");
                    }
                    else {
                        alert("修改失败");
                    }
                }
            })
        })
    })
    /* 权限加载方法*/
    function Show() {
        $.ajax({
            url: 'http://localhost:8086/rbac/permissions',
            type: 'get',
            async: false,
            success: function (data) {
                $(data).each(function (index, data) {
                    var list = '<label class=""> <input type="checkbox"  name="PermissionName"  value="' + data.Id + '">' + data.PermissionName + '</label>&nbsp;&nbsp;&nbsp;&nbsp;'
                    $("#dl1").append(list);
                })
            }
        })
    }
</script>